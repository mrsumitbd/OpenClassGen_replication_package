class UploadedFileRelations(object):
    '''
    Contains run method that will be called via project upload file post-processor.
    '''

    def __init__(self, activity):
        '''
        :param activity: CopyActivity: info about the activity associated with the files we are uploading
        '''
        self.activity = activity

    def run(self, data_service, file_details):
        '''
        Attach a remote file to activity with was generated by relationship.
        :param data_service: DataServiceApi: service used to attach relationship
        :param file_details: dict: response from DukeDS POST to /files/ containing current_version id
        '''
        used_entity_id = self._lookup_used_entity_id(file_details)
        if used_entity_id:
            data_service.create_relationship(
                from_entity_id=file_details['current_version']['id'],
                to_entity_id=used_entity_id,
                relationship_type='wasGeneratedBy'
            )

    def _lookup_used_entity_id(self, file_details):
        '''
        Return the file_version_id associated with the path from file_details.
        The file_version_id is looked up from a dictionary in the activity.
        :param file_details: dict: response from DukeDS POST to /files/
        :return: str: file_version_id uuid
        '''
        file_path = file_details.get('path')
        if file_path and hasattr(self.activity, 'used_files') and self.activity.used_files:
            return self.activity.used_files.get(file_path)
        return None